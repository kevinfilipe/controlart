package com.controlart.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import com.controlart.dao.factory.ConnFactory;
import com.controlart.dao.utils.DaoUtils;
import com.controlart.transfer.ImagemT;
import com.controlart.transfer.PessoaT;

public class ImagemDao {
	private Connection connection;

	private static final String SQL_CONSULT_BY_PECA = "SELECT tp.* FROM tb_imagem tp WHERE tp.id_peca = ? AND in_ativo = 1";
	private static final String SQL_INSERT = "INSERT INTO tb_imagem (id_peca, nm_imagem, ds_caminho) VALUES (?, ?, ?)";

	public ImagemDao() throws SQLException {
		connection = ConnFactory.getConnection();
	}

	public List<PessoaT> consultAll() throws SQLException {
		PreparedStatement pStmt = null;
		ResultSet rs = null;

		try {
			pStmt = connection.prepareStatement(SQL_CONSULT_BY_PECA);

			rs = pStmt.executeQuery();

			return resultsetToObjectPessoaT1(rs);
		} finally {
			DaoUtils.closeStatementAndResultSet(pStmt, rs);
			DaoUtils.closeConnection(connection);
		}
	}

	public void insert(List<ImagemT> listImagemT) throws SQLException {
		PreparedStatement pStmt = null;

		try {
			for (ImagemT imagemT : listImagemT) {
				pStmt = connection.prepareStatement(SQL_INSERT);
				pStmt.setObject(1, imagemT.getPeca());
				pStmt.setObject(2, imagemT.getNome());
				pStmt.setObject(3, imagemT.getNome());

				pStmt.execute();
			}
		} finally {
			DaoUtils.closePreparedStatement(pStmt);
			DaoUtils.closeConnection(connection);
		}
	}
}
